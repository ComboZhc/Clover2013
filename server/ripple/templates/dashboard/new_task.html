{% extends "dashboard/base.html" %}

{% load tags %}
{% load staticfiles %}

{% block title %}
    Create Task
{% endblock %}

{% block navbar_js %}
    $("li#link-new-task").addClass("active");
{% endblock %}

{% block page_title %}
<h3>Create a task</h3>
{% endblock %}

{% block content %}
    <div id="trigger-panel">
        <div class="row-fluid">
            <div class="span12">
                <h3>Choose a trigger</h3>
            </div>
        </div>
        {% for trigger in triggers %}
            {% if forloop.first %}<div class="row-fluid">{% elif forloop.counter0|divisibleby:3 %}</div><div class="row-fluid">{% endif %}
            {% trigger_grid trigger %}
            {% if forloop.last %}</div>{% endif %}
        {% endfor %}
    </div>

    <div id="action-panel" style="display:none">
        <div class="row-fluid">
            <div class="span12">
                <h3>Choose a action</h3>
            </div>
        </div>
        {% for action in actions %}
            {% if forloop.first %}<div class="row-fluid">{% elif forloop.counter0|divisibleby:3 %}</div><div class="row-fluid">{% endif %}
            {% action_grid action %}
            {% if forloop.last %}</div>{% endif %}
        {% endfor %}
    </div>

    <div id="form-panel" style="display:none">
        <div class="row-fluid">
            <div class="span12">
                <h3>Extra information</h3>
            </div>
        </div>
        <form id="task_new_form" class="form-horizontal" method="post" action="">
            {% csrf_token %}
            {{ form.non_field_errors }}
            {% for field in form.visible_fields %}
                <div class="control-group">
                    {{ field.errors }}
                    {{ field|label_with_classes:"control-label"}} 
                    <div class="controls">
                        {{ field }}
                    </div>
                </div>
            {% endfor %}
            {% for field in form.hidden_fields %}
                <div style="display:none;">{{ field }}</div>
            {% endfor %}
            <input class="btn btn-large btn-primary" type="submit" value="create" />
        </form>
    </div>

    <script>
    (function(){
        $(".trigger-grid").click(function() {
            $(".trigger-grid").removeClass("chosen");
            $(this).addClass("chosen");
            $("input#id_trigger_kind").val($(this).attr('id'));
            if ($("#action-panel").is(":hidden"))
                $("#action-panel").slideDown();
        });
        $(".action-grid").click(function() {
            $(".action-grid").removeClass("chosen");
            $(this).addClass("chosen");
            $("input#id_action_kind").val($(this).attr('id'));
            if ($("#form-panel").is(":hidden"))
                $("#form-panel").slideDown();
        });
    }).call(this);
    </script>



{% endblock %}